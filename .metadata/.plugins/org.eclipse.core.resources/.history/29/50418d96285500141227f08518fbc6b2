package com.example.myapp;

import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.util.ArrayList;

import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.NameValuePair;
import org.apache.http.client.HttpClient;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.message.BasicNameValuePair;
import org.json.JSONException;
import org.json.JSONObject;




import android.content.Context;
import android.util.Log;

public class Authenticate {
	private String token = "";
	private Context context;
    public Authenticate(final Context context)
    {	
    	this.context = context;
    	FileManager tokenFile = new FileManager("token",context);
        ArrayList<NameValuePair> params = new ArrayList<NameValuePair>();
        params.add(new BasicNameValuePair("username", username));
        params.add(new BasicNameValuePair("password", password));
    	HttpRequest request = new HttpRequest("https://www.diyby.me/android-connect/login.php");
    	JSONObject result = request.get(params);
                
		if(result == null)
		{
			tokenFile.write("");
			this.token = "";
		}
		else
		{
			
			try {
				int status = 0;
				status = result.getInt("success");
				if(status == 1)
				{
					this.token = result.getString("token");
				}
			} catch (JSONException e) {
				e.printStackTrace();
			}
			tokenFile.write(token);
		}
    }
    public Authenticate(final String username, final String password, final Context context)
    {
    	this.context = context;

    	FileManager tokenFile = new FileManager("token",context);
        ArrayList<NameValuePair> params = new ArrayList<NameValuePair>();
        params.add(new BasicNameValuePair("username", username));
        params.add(new BasicNameValuePair("password", password));
    	HttpRequest request = new HttpRequest("https://www.diyby.me/android-connect/login.php");
    	JSONObject result = request.get(params);
                
		if(result == null)
		{
			tokenFile.write("");
			this.token = "";
		}
		else
		{
			
			try {
				int status = 0;
				status = result.getInt("success");
				if(status == 1)
				{
					this.token = result.getString("token");
				}
			} catch (JSONException e) {
				e.printStackTrace();
			}
			tokenFile.write(token);
		}
    }
    public boolean islogin()
    {
    	if(this.token.isEmpty())
    	{
    		return false;
    	}
    	return true;
    }
    public String getToken()
    {
    	return this.token;
    }
}
